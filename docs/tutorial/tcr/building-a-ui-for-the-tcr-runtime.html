<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building a UI for the TCR runtime · Substrate Developer Hub</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;In &lt;a href=&quot;https://docs.substrate.dev/v1.0.0/docs/building-the-substrate-tcr-runtime&quot;&gt;part 1 of the guide&lt;/a&gt;, we covered the implementation of a simple Token Curated Registry chain using Substrate runtime modules. This is part 3 of the guide covering the development of a simple UI for the TCR runtime.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Building a UI for the TCR runtime · Substrate Developer Hub"/><meta property="og:type" content="website"/><meta property="og:url" content="https://substrate-developer-hub.github.io//docs/"/><meta property="og:description" content="&lt;p&gt;In &lt;a href=&quot;https://docs.substrate.dev/v1.0.0/docs/building-the-substrate-tcr-runtime&quot;&gt;part 1 of the guide&lt;/a&gt;, we covered the implementation of a simple Token Curated Registry chain using Substrate runtime modules. This is part 3 of the guide covering the development of a simple UI for the TCR runtime.&lt;/p&gt;
"/><meta property="og:image" content="https://substrate-developer-hub.github.io//docs/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://substrate-developer-hub.github.io//docs/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/docs/img/Substrate-logo.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/docs/css/main.css"/><script src="/docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docs/"><img class="logo" src="/docs/img/Substrate-logo.svg" alt="Substrate Developer Hub"/><h2 class="headerTitleWithLogo">Substrate Developer Hub</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/docs" target="_self">Docs</a></li><li class=""><a href="/docs/tutorials" target="_self">Tutorials</a></li><li class=""><a href="https://www.parity.io/blog/" target="_self">Blog</a></li><li class=""><a href="/docs/community" target="_self">Community</a></li><li class=""><a href="https://github.com/substrate-developer-hub/" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Tutorials</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Home</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/docs/">Docs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Contact Us</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/docs/contact/feedback">Feedback</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Quick Start</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/docs/quickstart/installing-substrate">Installing Substrate</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/quickstart/using-the-substrate-node-and-module-setup-scripts">Using the Substrate node and module setup scripts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Runtime</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Macros</h4><ul><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/macros/construct_runtime">Constructing a Runtime!</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/macros/decl_module">decl_module!</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/macros/decl_storage">runtime/macros/decl_storage</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Runtime Types</h4><ul><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/types/call-enum">Call Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/types/event-enum">Event Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/types/genesisconfig-struct">GenesisConfig Struct</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/architecture-of-a-runtime">Architecture of a Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/runtime/substrate-runtime-module-library">Substrate Runtime Module Library</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Substrate Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/docs/overview/extrinsics">Extrinsics</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/low-level-data-format">Low-level Data Format</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/runtime-and-api">Runtime and API</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/substrate-bonds">overview/substrate-bonds</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/telemetry">Telemetry</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/transaction-lifecycle">Transaction Lifecycle</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/overview/versioning">Versioning</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Building a Token Curated Registry DAppChain using Substrate</h4><ul><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/tcr/best-practices">Best Practices</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/docs/tutorial/tcr/building-a-ui-for-the-tcr-runtime">Building a UI for the TCR runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/tcr/building-an-event-based-off-chain-storage">Building an event based off-chain storage</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/tcr/building-the-substrate-tcr-runtime">Building the Substrate TCR runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/tcr/unit-testing-the-tcr-runtime-module">Unit testing the TCR runtime module</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/collator-nodes-on-polkadot-chains">tutorial/collator-nodes-on-polkadot-chains</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/creating-a-custom-substrate-chain">Creating a Custom Substrate chain</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/deploying-a-smart-contract-on-a-substrate-node-chain">Deploying a Smart Contract on a Substrate Node Chain</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/deploying-a-substrate-node-chain">Deploying a Substrate Node chain</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/governance--public--mechanism-with-a-substrate-node-chain">Governance &quot;Public&quot; Mechanism with a Substrate Node Chain</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/migrating-storage-to-a-new-substrate-node-s-runtime">Migrating Storage to a new Substrate Node&#x27;s Runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/substrate-collectables-workshop">tutorial/substrate-collectables-workshop</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/substrate-runtime-recipes">Substrate Runtime Recipes</a></li><li class="navListItem"><a class="navItem" href="/docs/docs/tutorial/validator-nodes-and-nominators-on-substrate-chains">Validator Nodes and Nominators on Substrate chains</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Building a UI for the TCR runtime</h1></header><article><div><span><p>In <a href="https://docs.substrate.dev/v1.0.0/docs/building-the-substrate-tcr-runtime">part 1 of the guide</a>, we covered the implementation of a simple Token Curated Registry chain using Substrate runtime modules. This is part 3 of the guide covering the development of a simple UI for the TCR runtime.</p>
<p>As part of the samples, we've created a <code>reactjs</code> based web app as a simple frontend for the TCR runtime. The code for the TCR UI sample is available <a href="https://github.com/parity-samples/substrate-tcr-ui">here</a>.</p>
<p>In this part of the guide, we will be covering the framework agnostic parts of the UI sample which are mainly used for interaction with the Substrate node and the TCR runtime extrinsic functions. We will not be going into the react specific parts - components, etc. The sample is created using the <code>create-react-app</code> scaffolding command. We have added a simple react component to display a list of items (TCR listings) and the corresponding TCR actions. We also have a couple of modals to take input for the <code>propose</code>, <code>challenge</code> and <code>vote</code> actions on a listing.</p>
<p>What's more important for this guide is the javascript code which interacts with the TCR runtime. We have used the <a href="https://polkadot.js.org/api/">PolkadotJS API</a> to achieve this.</p>
<p>In the sample, we have the <a href="https://github.com/parity-samples/substrate-tcr-ui/blob/master/src/services/tcrService.js">tcrService.js file</a> which contains all the relevant functions for interaction with the runtime. The following are packages and imports that we need from the PolkadotJS API to support this javascript code.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> { ApiPromise } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@polkadot/api'</span>);

<span class="hljs-keyword">const</span> { WsProvider } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@polkadot/rpc-provider'</span>);

<span class="hljs-keyword">const</span> { Keyring } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@polkadot/keyring'</span>);

<span class="hljs-keyword">const</span> { stringToU8a } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@polkadot/util'</span>);
</code></pre>
<p>The <a href="https://polkadot.js.org/api/">PolkadotJS API</a> is very well documented, with examples, so we will not be going into the details of the internals of those functions in this guide.</p>
<h2><a class="anchor" aria-hidden="true" id="signing-keys"></a><a href="#signing-keys" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Signing Keys</h2>
<p>To begin with, let's first look at how we represent the <code>origin</code> for the TCR runtime functions. All runtime functions are signed extrinsics. To sign the function calls from the UI before sending it to the Substrate node, we need signing keys of the user interacting with the UI. To do it, we take the seed from the user and create a keypair from it. In the following code snippet, we have a function that takes a seed string as a parameter and converts it into a keypair using the <code>keyring</code> object from the <code>@polkadot/keyring</code> package.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getKeysFromSeed</span>(<span class="hljs-params">_seed</span>) </span>{
 <span class="hljs-keyword">if</span> (!_seed) {
     <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Seed not valid."</span>);
 }

 <span class="hljs-keyword">const</span> keyring = <span class="hljs-keyword">new</span> Keyring();
 <span class="hljs-keyword">const</span> paddedSeed = _seed.padEnd(<span class="hljs-number">32</span>);
 <span class="hljs-keyword">return</span> keyring.addFromSeed(stringToU8a(paddedSeed));
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="api-connection-and-registering-custom-types"></a><a href="#api-connection-and-registering-custom-types" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Connection and registering custom types</h2>
<p>To call the Substrate runtime functions from our javascript code, we will need an <a href="https://polkadot.js.org/api/examples/promise/">API promise</a> object. We will also need to register our custom types so that the javascript code can infer the right values returned from the runtime events. Remember all those structs that we created to represent the TCR primitives in part 1 of this guide? Those are all the custom types that we need to register with the API promise object.</p>
<p>The following function creates and returns an API promise object with a <a href="https://polkadot.js.org/api/rpc-provider/classes/_ws_index_.wsprovider.html">websocket provider</a> and custom <a href="https://polkadot.js.org/api/types/">types</a>,</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createApiWithTypes</span>(<span class="hljs-params"></span>) </span>{
 <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> ApiPromise.create({
     <span class="hljs-attr">provider</span>: <span class="hljs-keyword">new</span> WsProvider(process.env.REACT_APP_SUBSTRATE_ADDR),
     <span class="hljs-attr">types</span>: {
      <span class="hljs-attr">Listing</span>: {
         <span class="hljs-string">"id"</span>: <span class="hljs-string">"u32"</span>,
         <span class="hljs-string">"data"</span>: <span class="hljs-string">"Vec&lt;u8&gt;"</span>,
         <span class="hljs-string">"deposit"</span>: <span class="hljs-string">"Balance"</span>,
         <span class="hljs-string">"owner"</span>: <span class="hljs-string">"AccountId"</span>,
         <span class="hljs-string">"application_expiry"</span>: <span class="hljs-string">"Moment"</span>,
         <span class="hljs-string">"whitelisted"</span>: <span class="hljs-string">"bool"</span>,
         <span class="hljs-string">"challenge_id"</span>: <span class="hljs-string">"u32"</span> },
      <span class="hljs-attr">Challenge</span>: {
          <span class="hljs-string">"listing_hash"</span>: <span class="hljs-string">"Hash"</span>,
          <span class="hljs-string">"deposit"</span>: <span class="hljs-string">"Balance"</span>,
          <span class="hljs-string">"owner"</span>: <span class="hljs-string">"AccountId"</span>,
          <span class="hljs-string">"voting_ends"</span>: <span class="hljs-string">"Moment"</span>,
          <span class="hljs-string">"resolved"</span>: <span class="hljs-string">"bool"</span>,
          <span class="hljs-string">"reward_pool"</span>: <span class="hljs-string">"Balance"</span>,
          <span class="hljs-string">"total_tokens"</span>: <span class="hljs-string">"Balance"</span> },
      <span class="hljs-attr">Poll</span>: {
          <span class="hljs-string">"listing_hash"</span>: <span class="hljs-string">"Hash"</span>,
          <span class="hljs-string">"votes_for"</span>: <span class="hljs-string">"Balance"</span>,
          <span class="hljs-string">"votes_against"</span>: <span class="hljs-string">"Balance"</span>,
          <span class="hljs-string">"passed"</span>: <span class="hljs-string">"bool"</span> },
      <span class="hljs-attr">Vote</span>: {
          <span class="hljs-string">"value"</span>: <span class="hljs-string">"bool"</span>,
          <span class="hljs-string">"deposit"</span>: <span class="hljs-string">"Balance"</span>,
          <span class="hljs-string">"claimed"</span>: <span class="hljs-string">"bool"</span> },
      <span class="hljs-attr">TokenBalance</span>: <span class="hljs-string">"u128"</span>
    }
 });
}

</code></pre>
<h2><a class="anchor" aria-hidden="true" id="calling-the-tcr-runtime-functions"></a><a href="#calling-the-tcr-runtime-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Calling the TCR runtime functions</h2>
<p>Now that we have our signing keys and a connection to the Substrate node, we are good to proceed with the TCR runtime function calls.</p>
<h3><a class="anchor" aria-hidden="true" id="propose"></a><a href="#propose" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Propose</h3>
<p>In the following code snippet, we have a function that first gets a new API promise object created using the <code>_createApiWithTypes</code> function described above. It then gets the keypair from the seed by calling the <code>_getKeysFromSeed</code> function, also described before. In the sample, we are storing the seed in the browser local storage so that the user does not have to enter it again. However, in a real production app, we should find a more secure way of handling the seed at the client side.</p>
<p>The <code>propose</code> function takes a listing name and deposit amount as parameters. After creating the keypair and API promise objects, we call the <code>propose</code> function of the TCR runtime module. Note the dynamic binding on the runtime module name and function name in the <code>api.tx.tcr.propose</code> call. The PolkadotJS API automatically binds the runtime module name and the function name. This is also described as part of the <a href="https://polkadot.js.org/api/api/classes/_base_.apibase.md#tx">API documentation</a>. Then we call the <code>signAndSend</code> function with the keypair.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyListing</span>(<span class="hljs-params">name, deposit</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; {
    <span class="hljs-keyword">const</span> api = <span class="hljs-keyword">await</span> ApiPromise.create();
    <span class="hljs-keyword">const</span> keys = _getKeysFromSeed();

    <span class="hljs-comment">// create, sign and send transaction</span>
    api.tx.tcr.propose(name, deposit)
      .signAndSend(keys, ({ events = [], status, type }) =&gt; {
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'Finalised'</span>) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Completed at block hash'</span>, status.asFinalised.toHex());
          events.forEach(<span class="hljs-keyword">async</span> ({ phase, <span class="hljs-attr">event</span>: { data, method, section } }) =&gt; {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'\t'</span>, phase.toString(), <span class="hljs-string">`: <span class="hljs-subst">${section}</span>.<span class="hljs-subst">${method}</span>`</span>, data.toString());

            <span class="hljs-comment">// check if the tcr proposed event was emitted by Substrate runtime</span>
            <span class="hljs-keyword">if</span> (section.toString() ===  <span class="hljs-string">"tcr"</span> &amp;&amp; method.toString() === <span class="hljs-string">"Proposed"</span>) {
              <span class="hljs-comment">// insert metadata in off-chain store</span>
              <span class="hljs-keyword">const</span> datajson = <span class="hljs-built_in">JSON</span>.parse(data.toString());
              <span class="hljs-keyword">const</span> listingInstance = {
                <span class="hljs-attr">name</span>: name,
                <span class="hljs-attr">owner</span>: datajson[<span class="hljs-number">0</span>],
                <span class="hljs-attr">hash</span>: datajson[<span class="hljs-number">1</span>],
                <span class="hljs-attr">deposit</span>: datajson[<span class="hljs-number">2</span>],
                <span class="hljs-attr">isWhitelisted</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">challengeId</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">rejected</span>: <span class="hljs-literal">false</span>
              }
              <span class="hljs-keyword">await</span> dataService.insertListing(listingInstance);
              <span class="hljs-comment">// resolve the promise with listing data</span>
              resolve(listingInstance); 
            }
          });
        }
      })
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
  });
}
</code></pre>
<p>The <code>signAndSend</code> function also takes a callback as the second parameter. Inside this callback, we are expecting the events from the extrinsic call, among other things. These events are the same that we declared in part 1 of the guide. Remember from part 1 that the <code>propose</code> function of the runtime emitted the <code>Proposed</code> event with the hash, owner and deposit of the listing. We are expecting and handling this event when we call the <code>propose</code> function from the javascript code. If the event section is <code>tcr</code> and its method is <code>Proposed</code>, it means that the <code>propose</code> function in the runtime executed successfully and the listing got created in the TCR in the proposed state.</p>
<p>Ideally, in a real production app, we should subscribe to the events in a separate listener and should update the client side state in that. We should exit the <code>signAndSend</code> function with something like a <em>submitted</em> state. Then, when the extrinsic gets finalized and when we handle the event, we should update the status as <em>proposed</em>.</p>
<p>Notice that when we handle the <code>Proposed</code> event, we create a listing object and call the <code>insertListing</code> function in <code>dataService</code>. This is what we call priming off-chain storage based on events. We will cover more on this in the part 4 of the guide.</p>
<h3><a class="anchor" aria-hidden="true" id="calling-other-runtime-functions"></a><a href="#calling-other-runtime-functions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Calling other runtime functions</h3>
<p>Just like we called the <code>propose</code> function of the TCR runtime, we can call the <code>challenge</code>, <code>vote</code>, <code>resolve</code> and <code>claim_reward</code> functions also. In the exact same way, we call the functions using the <code>api.tx.&lt;module name&gt;.&lt;function name&gt;</code> convention and handle the corresponding events to update the UI and the off-chain state.</p>
<p>The <a href="https://github.com/parity-samples/substrate-tcr-ui/blob/master/src/services/tcrService.js">tcrService.js file</a> has all the function calls implemented in the same way.</p>
<p>In the next part of the guide, we will learn how we can build an event-based off-chain storage and use it to optimize our DAppChain solution.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/docs/tutorial/tcr/best-practices"><span class="arrow-prev">← </span><span>Best Practices</span></a><a class="docs-next button" href="/docs/docs/tutorial/tcr/building-an-event-based-off-chain-storage"><span>Building an event based off-chain storage</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#signing-keys">Signing Keys</a></li><li><a href="#api-connection-and-registering-custom-types">API Connection and registering custom types</a></li><li><a href="#calling-the-tcr-runtime-functions">Calling the TCR runtime functions</a><ul class="toc-headings"><li><a href="#propose">Propose</a></li><li><a href="#calling-other-runtime-functions">Calling other runtime functions</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/docs/" class="nav-home"><img src="/docs/img/Substrate-logo.svg" alt="Substrate Developer Hub" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/docs/docs/en/doc2.html">Guides (or other categories)</a><a href="/docs/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/docs/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/docs/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/docs/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Parity Technologies</section></footer></div></body></html>